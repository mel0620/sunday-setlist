<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunday Setlist</title>
        <!-- Favicon for most browsers -->
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicons/favicon-96x96.png">
    <link rel="icon" type="image/x-icon" href="img/favicons/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="img/favicons/favicon.svg">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="img/favicons/apple-touch-icon.png">

    <!-- Android Chrome Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="img/favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/favicons/android-chrome-512x512.png">

    <!-- Web App Manifest Icons (optional, fallback) -->
    <link rel="icon" type="image/png" sizes="192x192" href="img/favicons/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/favicons/web-app-manifest-512x512.png">
    <link href="output.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        /* Modal Transitions */
        .modal { background-color: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out; position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s ease-in-out; }
        .modal.is-visible { opacity: 1; pointer-events: auto; }
        .modal.is-visible .modal-content { transform: scale(1); }
    </style>
    <script>
        // Apply dark mode immediately from localStorage or system preference
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-slate-100 dark:bg-slate-900 font-sans text-slate-900 dark:text-slate-200 transition-colors duration-300">

    <div id="offline-indicator" class="hidden sticky top-0 z-50 bg-amber-500 text-white text-center p-2 font-semibold">
        You are currently offline. Showing cached data.
    </div>

    <div class="container mx-auto px-4 pb-4 md:px-6 md:pb-6">
        <header class="fixed inset-x-0 top-0 z-40 flex -mx-2 md:mx-0 justify-between items-center bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm py-4 px-6 shadow-sm">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800 dark:text-slate-100">Sunday Setlist</h1>
            <div class="flex items-center gap-2 md:gap-4">
                <button id="create-setlist-btn" class="hidden text-sm md:text-base bg-sky-600 text-white py-2 px-4 rounded-full hover:bg-sky-700 transition font-semibold shadow-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                    <span class="hidden md:flex">Create Setlist</span>
                </button>
                <button id="login-nav-btn" class="text-sm md:text-base bg-slate-700 text-white py-2 px-4 rounded-full hover:bg-slate-800 transition font-semibold flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                        <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                    Login
                </button>
                <button id="logout-btn" class="hidden text-sm md:text-base bg-red-600 text-white py-2 px-4 rounded-full hover:bg-red-700 transition font-semibold flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                    <span class="hidden md:flex">Logout</span>
                </button>
            </div>
        </header>

        <main id="app-container" class="mt-24">
            <div class="mb-8">
                <input type="search" id="search-bar" placeholder="🔍 Search by song, leader, or role..." class="w-full p-3 bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 transition">
            </div>

            <!-- Loader Spinner -->
            <div id="setlist-loader" class="flex justify-center py-12">
                <div class="w-10 h-10 border-4 border-sky-500 border-t-transparent rounded-full animate-spin"></div>
            </div>

            <section id="setlist-form-container" class="hidden mb-6"></section>
            <section id="setlist-previews">
                <div id="latest-setlist-container"></div>
                <div id="history-setlists-container"></div>
                <div id="pagination-container" class="mt-8 flex justify-center items-center gap-4"></div>
            </section>
        </main>
    </div>

    <div id="login-modal" class="modal">
        <section class="modal-content relative max-w-md w-full bg-white dark:bg-slate-800 p-8 rounded-xl shadow-2xl mx-4">
             <button id="close-login-modal-btn" title="Close" class="absolute top-3 right-3 p-2 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold mb-6 text-center text-slate-800 dark:text-slate-100">User Login</h2>
            <div class="space-y-4">
                <input type="email" id="email" placeholder="Email" class="w-full p-3 bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                <input type="password" id="password" placeholder="Password" class="w-full p-3 bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                <button id="login-btn" class="w-full bg-sky-600 text-white p-3 rounded-lg hover:bg-sky-700 transition font-bold shadow">Login</button>
            </div>
            <p id="login-error" class="text-red-500 text-center mt-4"></p>
        </section>
    </div>
    <div id="lyrics-modal" class="modal">
         <div class="modal-content relative max-w-2xl w-full bg-white dark:bg-slate-800 p-8 rounded-xl shadow-2xl max-h-[80vh] overflow-y-auto mx-4">
             <button id="close-lyrics-modal-btn" title="Close" class="absolute top-3 right-3 p-2 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
             <h2 id="lyrics-song-name" class="text-xl md:text-3xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-4"></h2>
             <pre id="lyrics-content" class="text-slate-700 dark:text-slate-300 whitespace-pre-wrap font-sans text-base leading-relaxed"></pre>
         </div>
    </div>
    <div id="sequence-modal" class="modal">
         <div class="modal-content relative max-w-2xl w-full bg-white dark:bg-slate-800 p-8 rounded-xl shadow-2xl max-h-[80vh] overflow-y-auto mx-4">
             <button id="close-sequence-modal-btn" title="Close" class="absolute top-3 right-3 p-2 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
             <h2 id="sequence-song-name" class="text-xl md:text-3xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-4"></h2>
             <pre id="sequence-content" class="text-slate-700 dark:text-slate-300 whitespace-pre-wrap font-sans text-base leading-relaxed"></pre>
         </div>
    </div>
    <div id="chords-modal" class="modal">
         <div class="modal-content relative max-w-2xl w-full bg-white dark:bg-slate-800 p-8 rounded-xl shadow-2xl max-h-[80vh] overflow-y-auto mx-4">
             <button id="close-chords-modal-btn" title="Close" class="absolute top-3 right-3 p-2 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
             <h2 id="chords-song-name" class="text-xl md:text-3xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-4"></h2>
             <pre id="chords-content" class="text-slate-700 dark:text-slate-300 whitespace-pre-wrap font-sans text-base leading-relaxed"></pre>
         </div>
    </div>

    <!-- Toast Container -->
    <div id="toast" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] hidden bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg transition-opacity duration-300"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="app.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>